import{_ as l,r as e,c as a,o as t,H as o,a as s,b as r,d as n,n as i,t as c,w as d,v as u,e as h,f as v,F as p,g as f,h as g,i as b,j as y,k as w,l as F}from"./index-Cx3PQcZq.js";const m={class:"hdfs-explorer"},k={class:"status-bar"},D={class:"status-text"},C={class:"path-navigator"},P=["disabled"],S={class:"explorer-toolbar"},x={key:0,class:"loading"},$={key:1,class:"error-message"},T={key:2,class:"empty-directory"},H={key:3,class:"file-list"},N=["onClick"],U={key:0,class:"folder-icon"},B={key:1,class:"file-icon"},E={class:"actions"},M=["onClick"],_=["onClick"],j={class:"dialog"},V={class:"form-group"},z={class:"form-group"},I={class:"dialog-actions"},K=["disabled"],R={class:"dialog"},G={class:"form-group"},L={class:"form-group"},W={key:0,class:"upload-progress"},q={class:"progress-bar"},A={class:"progress-text"},J={class:"dialog-actions"},O=["disabled"];const Q={class:"hdfs-explorer-view"};const X=l({name:"HDFSExplorerView",components:{HDFSExplorer:l({name:"HDFSExplorer",props:{initialPath:{type:String,default:"/"}},setup(l){const s=e(!1),r=e(""),n=e(l.initialPath),i=e([]),c=e(!1),d=e(null),u=e(!1),h=e(!1),v=e(""),p=e(null),f=e(!1),g=e(0),b=a((()=>"/"===n.value||""===n.value));t((async()=>{try{await y(),s.value&&await w()}catch(l){}}));const y=async()=>{try{const l=await o.getStatus();s.value=l.connected,r.value=l.uri||""}catch(l){s.value=!1,r.value=""}},w=async()=>{var l,e;n.value||(n.value="/");const a=m(n.value);n.value=a,c.value=!0,d.value=null;try{if(!s.value)throw new Error("HDFS未连接，无法浏览目录");const l=await o.listFiles(a);i.value=l}catch(t){d.value=(null==(e=null==(l=t.response)?void 0:l.data)?void 0:e.error)||t.message,i.value=[]}finally{c.value=!1}},F=()=>{w()},m=l=>{if(l.includes("hdfs:")){const e=l.match(/^hdfs:\/\/[^\/]+(.*)$/);if(e&&e[1])return e[1]||"/"}if(l.includes("://")){const e=l.match(/^.*:\/\/[^\/]+(.*)$/);if(e&&e[1])return e[1]||"/"}return l.startsWith("/")?l:"/"+l};return{connected:s,hdfsUri:r,currentPath:n,files:i,loading:c,error:d,showNewFolderDialog:u,showUploadDialog:h,newFolderName:v,selectedFile:p,uploading:f,uploadProgress:g,isRootDir:b,refreshStatus:y,browseToPath:w,refreshCurrentPath:F,handleFileClick:l=>{l.isDirectory&&(n.value=m(l.path),w())},goToParentDir:()=>{if(b.value)return;const l=m(n.value).split("/").filter((l=>l));l.pop(),n.value=l.length>0?"/"+l.join("/"):"/",w()},createFolder:async()=>{var l,e;if(v.value)try{const l=`${m(n.value)}/${v.value}`.replace(/\/\//g,"/");await o.createDirectory(l),u.value=!1,v.value="",F()}catch(a){alert(`创建文件夹失败: ${(null==(e=null==(l=a.response)?void 0:l.data)?void 0:e.error)||a.message}`)}},handleFileChange:l=>{p.value=l.target.files[0],g.value=0},uploadFile:async()=>{var l,e;if(p.value){f.value=!0,g.value=0;try{const l=`${m(n.value)}/${p.value.name}`.replace(/\/\//g,"/");await o.uploadFile(p.value,l,(l=>{g.value=l})),h.value=!1,p.value=null,F()}catch(a){alert(`上传文件失败: ${(null==(e=null==(l=a.response)?void 0:l.data)?void 0:e.error)||a.message}`)}finally{f.value=!1}}},downloadFile:async l=>{var e,a;try{const e=m(l.path),a=await o.downloadFile(e);o.saveFile(a,l.name)}catch(t){alert(`下载文件失败: ${(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||t.message}`)}},deleteFile:async l=>{var e,a;if(confirm(`确定要删除 ${l.name} 吗？${l.isDirectory?"这将删除目录中的所有内容！":""}`))try{const e=m(l.path);await o.deleteFile(e,l.isDirectory),F()}catch(t){alert(`删除失败: ${(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||t.message}`)}},formatFileSize:l=>{if(0===l)return"0 B";if(null==l)return"-";const e=Math.floor(Math.log(l)/Math.log(1024));return(l/Math.pow(1024,e)).toFixed(2)+" "+["B","KB","MB","GB","TB"][e]},formatDate:l=>{if(!l)return"-";return new Date(l).toLocaleString()}}}},[["render",function(l,e,a,t,o,w){return y(),s("div",m,[r("div",k,[r("span",{class:i(["status-indicator",t.connected?"connected":"disconnected"])},null,2),r("span",D,c(t.connected?"已连接":"未连接")+" "+c(t.hdfsUri),1),r("button",{onClick:e[0]||(e[0]=(...l)=>t.refreshStatus&&t.refreshStatus(...l)),class:"refresh-btn"},"刷新")]),r("div",C,[d(r("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>t.currentPath=l),class:"path-input",onKeyup:e[2]||(e[2]=h(((...l)=>t.browseToPath&&t.browseToPath(...l)),["enter"])),placeholder:"HDFS路径，如 /user/data"},null,544),[[u,t.currentPath]]),r("button",{onClick:e[3]||(e[3]=(...l)=>t.browseToPath&&t.browseToPath(...l)),class:"browse-btn"},"浏览"),r("button",{onClick:e[4]||(e[4]=(...l)=>t.goToParentDir&&t.goToParentDir(...l)),class:"parent-dir-btn",disabled:t.isRootDir},"上级目录",8,P)]),r("div",S,[r("button",{onClick:e[5]||(e[5]=l=>t.showNewFolderDialog=!0),class:"toolbar-btn"},e[17]||(e[17]=[r("i",{class:"folder-icon"},"📁",-1),v(" 新建文件夹 ")])),r("button",{onClick:e[6]||(e[6]=l=>t.showUploadDialog=!0),class:"toolbar-btn"},e[18]||(e[18]=[r("i",{class:"upload-icon"},"⬆️",-1),v(" 上传文件 ")])),r("button",{onClick:e[7]||(e[7]=(...l)=>t.refreshCurrentPath&&t.refreshCurrentPath(...l)),class:"toolbar-btn"},e[19]||(e[19]=[r("i",{class:"refresh-icon"},"🔄",-1),v(" 刷新 ")]))]),t.loading?(y(),s("div",x," 加载中... ")):t.error?(y(),s("div",$,[r("p",null,"加载失败: "+c(t.error),1),r("button",{onClick:e[8]||(e[8]=(...l)=>t.refreshCurrentPath&&t.refreshCurrentPath(...l)),class:"retry-btn"},"重试")])):0===t.files.length?(y(),s("div",T,e[20]||(e[20]=[r("p",null,"当前目录为空",-1)]))):(y(),s("div",H,[r("table",null,[e[21]||(e[21]=r("thead",null,[r("tr",null,[r("th",null,"名称"),r("th",null,"类型"),r("th",null,"大小"),r("th",null,"权限"),r("th",null,"修改时间"),r("th",null,"操作")])],-1)),r("tbody",null,[(y(!0),s(p,null,f(t.files,((l,e)=>(y(),s("tr",{key:e},[r("td",null,[r("div",{class:"file-name",onClick:e=>t.handleFileClick(l)},[l.isDirectory?(y(),s("i",U,"📁")):(y(),s("i",B,"📄")),v(" "+c(l.name),1)],8,N)]),r("td",null,c(l.isDirectory?"目录":"文件"),1),r("td",null,c(t.formatFileSize(l.length)),1),r("td",null,c(l.permission),1),r("td",null,c(t.formatDate(l.modificationTime)),1),r("td",E,[l.isDirectory?n("",!0):(y(),s("button",{key:0,onClick:e=>t.downloadFile(l),class:"action-btn download-btn"}," 下载 ",8,M)),r("button",{onClick:e=>t.deleteFile(l),class:"action-btn delete-btn"}," 删除 ",8,_)])])))),128))])])])),t.showNewFolderDialog?(y(),s("div",{key:4,class:"dialog-overlay",onClick:e[12]||(e[12]=g((l=>t.showNewFolderDialog=!1),["self"]))},[r("div",j,[e[23]||(e[23]=r("h3",null,"新建文件夹",-1)),r("div",V,[r("label",null,"当前路径: "+c(t.currentPath),1)]),r("div",z,[e[22]||(e[22]=r("label",{for:"folder-name"},"文件夹名称:",-1)),d(r("input",{type:"text",id:"folder-name","onUpdate:modelValue":e[9]||(e[9]=l=>t.newFolderName=l)},null,512),[[u,t.newFolderName]])]),r("div",I,[r("button",{onClick:e[10]||(e[10]=l=>t.showNewFolderDialog=!1),class:"cancel-btn"},"取消"),r("button",{onClick:e[11]||(e[11]=(...l)=>t.createFolder&&t.createFolder(...l)),class:"create-btn",disabled:!t.newFolderName},"创建",8,K)])])])):n("",!0),t.showUploadDialog?(y(),s("div",{key:5,class:"dialog-overlay",onClick:e[16]||(e[16]=g((l=>t.showUploadDialog=!1),["self"]))},[r("div",R,[e[25]||(e[25]=r("h3",null,"上传文件",-1)),r("div",G,[r("label",null,"上传到: "+c(t.currentPath),1)]),r("div",L,[e[24]||(e[24]=r("label",{for:"file-upload"},"选择文件:",-1)),r("input",{type:"file",id:"file-upload",onChange:e[13]||(e[13]=(...l)=>t.handleFileChange&&t.handleFileChange(...l))},null,32)]),t.uploadProgress>0?(y(),s("div",W,[r("div",q,[r("div",{class:"progress-fill",style:b({width:t.uploadProgress+"%"})},null,4)]),r("div",A,c(t.uploadProgress)+"%",1)])):n("",!0),r("div",J,[r("button",{onClick:e[14]||(e[14]=l=>t.showUploadDialog=!1),class:"cancel-btn"},"取消"),r("button",{onClick:e[15]||(e[15]=(...l)=>t.uploadFile&&t.uploadFile(...l)),class:"upload-btn",disabled:!t.selectedFile||t.uploading},c(t.uploading?"上传中...":"上传"),9,O)])])])):n("",!0)])}],["__scopeId","data-v-04f5e249"]])}},[["render",function(l,e,a,t,o,n){const i=F("HDFSExplorer");return y(),s("div",Q,[e[0]||(e[0]=r("h2",null,"HDFS文件浏览器",-1)),e[1]||(e[1]=r("p",{class:"description"},"浏览并管理HDFS文件系统中的文件和目录",-1)),w(i)])}],["__scopeId","data-v-0a703527"]]);export{X as default};
