import{_ as e,r as a,c as l,o as t,p as n,m as s,a as o,b as i,d as u,n as r,t as c,w as m,q as v,F as d,g,s as y,v as p,j as b,k as h,l as f}from"./index-Cx3PQcZq.js";const C={class:"hive-analytics"},k={class:"status-bar"},F={class:"status-text"},A={class:"database-selection"},_={class:"selection-item"},x=["value"],T={class:"selection-item"},S=["value"],w={class:"analytics-selection"},U={class:"analytics-types"},N=["onClick"],V={key:0,class:"empty-selection"},j={key:1,class:"analysis-section"},R={class:"section-header"},O={key:0,class:"loading"},H={key:1},B={class:"config-form"},D={key:0,class:"form-container"},L={class:"form-group"},M=["value"],E={class:"form-group"},$={class:"form-group"},J=["value"],z={class:"form-group"},I={class:"form-group"},G={key:1,class:"form-container"},W={class:"form-group"},X=["value"],q={class:"form-group"},K=["value"],P={class:"form-group"},Q={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},ee={key:2,class:"form-container"},ae={class:"form-group"},le=["value"],te={class:"form-group"},ne={key:3,class:"form-container"},se={class:"form-group"},oe=["value"],ie={key:4,class:"form-container"},ue={class:"form-group"},re=["value"],ce={class:"form-group"},me=["value"],ve={key:5,class:"form-container"},de={class:"form-group"},ge=["value"],ye={class:"form-group"},pe={key:0,class:"results-section"},be={key:0,class:"result-table"},he={key:1,class:"result-object"},fe={class:"result-key"},Ce={class:"result-value"},ke={key:2,class:"visualization"},Fe={class:"chart-container"},Ae={ref:"chartContainer",class:"chart"},_e={class:"export-options"};const xe={class:"hive-analytics-view"};const Te=e({name:"HiveAnalyticsView",components:{HiveAnalytics:e({name:"HiveAnalytics",setup(){const e=a(!1),o=a(""),i=a([]),u=a([]),r=a(""),c=a(""),m=a([]),v=[{id:"aggregate",name:"聚合分析",icon:"aggregate-icon"},{id:"timeseries",name:"时间序列分析",icon:"timeseries-icon"},{id:"distribution",name:"列值分布",icon:"distribution-icon"},{id:"statistics",name:"统计信息",icon:"statistics-icon"},{id:"correlation",name:"相关性分析",icon:"correlation-icon"},{id:"histogram",name:"直方图",icon:"histogram-icon"}],d=a(""),g=a(!1),y=a([]),p=a({}),b=a(!1),h=a(null),f=a({aggregateColumn:"",aggregateFunction:"COUNT",groupByColumn:"",whereClause:"",limit:50}),C=a({timeColumn:"",valueColumn:"",interval:"day",aggregateFunction:"AVG",whereClause:"",limit:100}),k=a({columnName:"",limit:50}),F=a({columnName:""}),A=a({column1:"",column2:""}),_=a({columnName:"",numBuckets:10}),x=l((()=>m.value.filter((e=>{const a=e.data_type?e.data_type.toLowerCase():"";return a.includes("int")||a.includes("double")||a.includes("float")||a.includes("decimal")||a.includes("numeric")})))),T=l((()=>m.value.filter((e=>{const a=e.data_type?e.data_type.toLowerCase():"";return a.includes("date")||a.includes("time")||a.includes("timestamp")}))));t((async()=>{await w(),e.value&&await U()})),n(c,(()=>{d.value="",R()})),n(d,(()=>{R(),S()}));const S=()=>{"aggregate"===d.value?x.value.length>0&&(f.value.aggregateColumn=x.value[0].col_name):"timeseries"===d.value?(T.value.length>0&&(C.value.timeColumn=T.value[0].col_name),x.value.length>0&&(C.value.valueColumn=x.value[0].col_name)):"distribution"===d.value?m.value.length>0&&(k.value.columnName=m.value[0].col_name):"statistics"===d.value?x.value.length>0&&(F.value.columnName=x.value[0].col_name):"correlation"===d.value?x.value.length>0&&(A.value.column1=x.value[0].col_name,x.value.length>1?A.value.column2=x.value[1].col_name:A.value.column2=x.value[0].col_name):"histogram"===d.value&&x.value.length>0&&(_.value.columnName=x.value[0].col_name)},w=async()=>{try{const a=await s.getStatus();return e.value=a.connected,o.value=a.url||"",e.value}catch(a){return e.value=!1,o.value="",!1}},U=async()=>{try{const e=await s.getDatabases();i.value=e.map((e=>({name:e}))),i.value.length>0&&!r.value&&(r.value=i.value[0].name,await N())}catch(e){i.value=[]}},N=async()=>{if(e.value&&r.value)try{const e=await s.getTables(r.value);u.value=e.map((e=>({name:e}))),u.value.length>0&&(c.value=u.value[0].name,await V())}catch(a){u.value=[]}else u.value=[]},V=async()=>{if(e.value&&c.value)try{const e=await s.getTableSchema(c.value,r.value);m.value=e}catch(a){m.value=[]}else m.value=[]},j=()=>{const e=v.find((e=>e.id===d.value));return e?e.name:""},R=()=>{y.value=[],p.value={},b.value=!1},O=e=>{if(!c.value)return alert("请先选择一个表"),!1;switch(e){case"aggregate":if(!f.value.aggregateColumn)return alert("请选择聚合列"),!1;break;case"timeseries":if(!C.value.timeColumn)return alert("请选择时间列"),!1;if(!C.value.valueColumn)return alert("请选择值列"),!1;break;case"distribution":if(!k.value.columnName)return alert("请选择目标列"),!1;break;case"statistics":if(!F.value.columnName)return alert("请选择目标列"),!1;break;case"correlation":if(!A.value.column1)return alert("请选择列1"),!1;if(!A.value.column2)return alert("请选择列2"),!1;break;case"histogram":if(!_.value.columnName)return alert("请选择目标列"),!1}return!0},H=(e,a)=>{if(!h.value)return;h.value.innerHTML="";const l=document.createElement("div");l.className="chart-placeholder",l.textContent=`已生成${j()}图表 - 数据点: ${a.length}`,h.value.appendChild(l)};return{connected:e,hiveUrl:o,databases:i,tables:u,currentDatabase:r,currentTable:c,tableSchema:m,numericColumns:x,dateColumns:T,analysisTypes:v,currentAnalysisType:d,loading:g,analysisResults:y,analysisResult:p,showVisualization:b,chartContainer:h,aggregateForm:f,timeSeriesForm:C,distributionForm:k,statisticsForm:F,correlationForm:A,histogramForm:_,refreshStatus:w,refreshDatabases:U,loadTables:N,loadTableSchema:V,selectAnalysisType:e=>{d.value=e},getAnalysisTypeLabel:j,executeAggregateAnalysis:async()=>{if(O("aggregate")){g.value=!0,R();try{const{aggregateColumn:e,aggregateFunction:a,groupByColumn:l,whereClause:t,limit:n}=f.value,o=await s.executeAggregateAnalysis(c.value,e,a,l,t,n);y.value=o,o.length>0&&(b.value=!0,setTimeout((()=>{H("aggregate",o)}),100))}catch(e){alert("执行聚合分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},executeTimeSeriesAnalysis:async()=>{if(O("timeseries")){g.value=!0,R();try{const{timeColumn:e,valueColumn:a,interval:l,aggregateFunction:t,whereClause:n,limit:o}=C.value,i=await s.executeTimeSeriesAnalysis(c.value,e,a,l,t,n,o);y.value=i,i.length>0&&(b.value=!0,setTimeout((()=>{H("timeseries",i)}),100))}catch(e){alert("执行时间序列分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},executeDistributionAnalysis:async()=>{if(O("distribution")){g.value=!0,R();try{const{columnName:e,limit:a}=k.value,l=await s.analyzeColumnDistribution(c.value,e,a);y.value=l,l.length>0&&(b.value=!0,setTimeout((()=>{H("distribution",l)}),100))}catch(e){alert("执行列值分布分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},executeStatisticsAnalysis:async()=>{if(O("statistics")){g.value=!0,R();try{const{columnName:e}=F.value,a=await s.calculateColumnStatistics(c.value,e);p.value=a}catch(e){alert("执行统计信息分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},executeCorrelationAnalysis:async()=>{if(O("correlation")){g.value=!0,R();try{const{column1:e,column2:a}=A.value,l=await s.calculateCorrelation(c.value,e,a);p.value=l}catch(e){alert("执行相关性分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},executeHistogramAnalysis:async()=>{if(O("histogram")){g.value=!0,R();try{const{columnName:e,numBuckets:a}=_.value,l=await s.generateHistogram(c.value,e,a);y.value=l,l.length>0&&(b.value=!0,setTimeout((()=>{H("histogram",l)}),100))}catch(e){alert("执行直方图分析失败: "+(e.message||"未知错误"))}finally{g.value=!1}}},exportResults:e=>{if(0===y.value.length&&0===Object.keys(p.value).length)return void alert("没有可导出的结果");let a,l=`${c.value}_${d.value}_analysis`;if("csv"===e)if(y.value.length>0){const e=Object.keys(y.value[0]),t=[e.join(","),...y.value.map((a=>e.map((e=>JSON.stringify(a[e]||""))).join(",")))].join("\n");a=new Blob([t],{type:"text/csv"}),l+=".csv"}else{const e=["key,value",...Object.entries(p.value).map((([e,a])=>`${JSON.stringify(e)},${JSON.stringify(a)}`))].join("\n");a=new Blob([e],{type:"text/csv"}),l+=".csv"}else if("json"===e){const e=JSON.stringify(y.value.length>0?y.value:p.value,null,2);a=new Blob([e],{type:"application/json"}),l+=".json"}const t=URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=l,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}}}},[["render",function(e,a,l,t,n,s){return b(),o("div",C,[i("div",k,[i("span",{class:r(["status-indicator",t.connected?"connected":"disconnected"])},null,2),i("span",F,c(t.connected?"已连接":"未连接")+" "+c(t.hiveUrl),1),i("button",{onClick:a[0]||(a[0]=(...e)=>t.refreshStatus&&t.refreshStatus(...e)),class:"refresh-btn"},"刷新")]),i("div",A,[i("div",_,[a[34]||(a[34]=i("label",null,"数据库:",-1)),m(i("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>t.currentDatabase=e),onChange:a[2]||(a[2]=(...e)=>t.loadTables&&t.loadTables(...e))},[(b(!0),o(d,null,g(t.databases,(e=>(b(),o("option",{key:e.name,value:e.name},c(e.name),9,x)))),128))],544),[[v,t.currentDatabase]]),i("button",{onClick:a[3]||(a[3]=(...e)=>t.refreshDatabases&&t.refreshDatabases(...e)),class:"refresh-btn small"},"刷新")]),i("div",T,[a[35]||(a[35]=i("label",null,"表:",-1)),m(i("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>t.currentTable=e),onChange:a[5]||(a[5]=(...e)=>t.loadTableSchema&&t.loadTableSchema(...e))},[(b(!0),o(d,null,g(t.tables,(e=>(b(),o("option",{key:e.name,value:e.name},c(e.name),9,S)))),128))],544),[[v,t.currentTable]]),i("button",{onClick:a[6]||(a[6]=(...e)=>t.loadTables&&t.loadTables(...e)),class:"refresh-btn small"},"刷新")])]),i("div",w,[a[36]||(a[36]=i("h3",null,"选择分析类型",-1)),i("div",U,[(b(!0),o(d,null,g(t.analysisTypes,(e=>(b(),o("div",{key:e.id,class:r(["analytics-type-item",{active:t.currentAnalysisType===e.id}]),onClick:a=>t.selectAnalysisType(e.id)},[i("i",{class:r(["analytics-icon",e.icon])},null,2),i("span",null,c(e.name),1)],10,N)))),128))])]),t.currentAnalysisType?u("",!0):(b(),o("div",V,a[37]||(a[37]=[i("p",null,"请选择一种分析类型开始数据分析",-1)]))),t.currentAnalysisType?(b(),o("div",j,[i("div",R,[i("h3",null,c(t.getAnalysisTypeLabel()),1),i("button",{onClick:a[7]||(a[7]=e=>t.currentAnalysisType=""),class:"back-btn"},"返回选择")]),t.loading?(b(),o("div",O,a[38]||(a[38]=[i("div",{class:"spinner"},null,-1),i("p",null,"正在执行分析...",-1)]))):(b(),o("div",H,[i("div",B,["aggregate"===t.currentAnalysisType?(b(),o("div",D,[i("div",L,[a[39]||(a[39]=i("label",null,"聚合列:",-1)),m(i("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>t.aggregateForm.aggregateColumn=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,M)))),128))],512),[[v,t.aggregateForm.aggregateColumn]])]),i("div",E,[a[41]||(a[41]=i("label",null,"聚合函数:",-1)),m(i("select",{"onUpdate:modelValue":a[9]||(a[9]=e=>t.aggregateForm.aggregateFunction=e)},a[40]||(a[40]=[y('<option value="COUNT" data-v-11e43b65>计数</option><option value="SUM" data-v-11e43b65>求和</option><option value="AVG" data-v-11e43b65>平均值</option><option value="MAX" data-v-11e43b65>最大值</option><option value="MIN" data-v-11e43b65>最小值</option>',5)]),512),[[v,t.aggregateForm.aggregateFunction]])]),i("div",$,[a[43]||(a[43]=i("label",null,"分组列:",-1)),m(i("select",{"onUpdate:modelValue":a[10]||(a[10]=e=>t.aggregateForm.groupByColumn=e)},[a[42]||(a[42]=i("option",{value:""},"-- 不分组 --",-1)),(b(!0),o(d,null,g(t.tableSchema,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,J)))),128))],512),[[v,t.aggregateForm.groupByColumn]])]),i("div",z,[a[44]||(a[44]=i("label",null,"条件:",-1)),m(i("input",{type:"text","onUpdate:modelValue":a[11]||(a[11]=e=>t.aggregateForm.whereClause=e),placeholder:"WHERE 子句 (可选)"},null,512),[[p,t.aggregateForm.whereClause]])]),i("div",I,[a[45]||(a[45]=i("label",null,"结果限制:",-1)),m(i("input",{type:"number","onUpdate:modelValue":a[12]||(a[12]=e=>t.aggregateForm.limit=e),min:"1",max:"1000",placeholder:"最大结果数"},null,512),[[p,t.aggregateForm.limit,void 0,{number:!0}]])]),i("button",{onClick:a[13]||(a[13]=(...e)=>t.executeAggregateAnalysis&&t.executeAggregateAnalysis(...e)),class:"execute-btn"},"执行分析")])):"timeseries"===t.currentAnalysisType?(b(),o("div",G,[i("div",W,[a[46]||(a[46]=i("label",null,"时间列:",-1)),m(i("select",{"onUpdate:modelValue":a[14]||(a[14]=e=>t.timeSeriesForm.timeColumn=e)},[(b(!0),o(d,null,g(t.dateColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,X)))),128))],512),[[v,t.timeSeriesForm.timeColumn]])]),i("div",q,[a[47]||(a[47]=i("label",null,"值列:",-1)),m(i("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>t.timeSeriesForm.valueColumn=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,K)))),128))],512),[[v,t.timeSeriesForm.valueColumn]])]),i("div",P,[a[49]||(a[49]=i("label",null,"时间间隔:",-1)),m(i("select",{"onUpdate:modelValue":a[16]||(a[16]=e=>t.timeSeriesForm.interval=e)},a[48]||(a[48]=[i("option",{value:"day"},"天",-1),i("option",{value:"week"},"周",-1),i("option",{value:"month"},"月",-1),i("option",{value:"year"},"年",-1)]),512),[[v,t.timeSeriesForm.interval]])]),i("div",Q,[a[51]||(a[51]=i("label",null,"聚合函数:",-1)),m(i("select",{"onUpdate:modelValue":a[17]||(a[17]=e=>t.timeSeriesForm.aggregateFunction=e)},a[50]||(a[50]=[y('<option value="COUNT" data-v-11e43b65>计数</option><option value="SUM" data-v-11e43b65>求和</option><option value="AVG" data-v-11e43b65>平均值</option><option value="MAX" data-v-11e43b65>最大值</option><option value="MIN" data-v-11e43b65>最小值</option>',5)]),512),[[v,t.timeSeriesForm.aggregateFunction]])]),i("div",Y,[a[52]||(a[52]=i("label",null,"条件:",-1)),m(i("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=e=>t.timeSeriesForm.whereClause=e),placeholder:"WHERE 子句 (可选)"},null,512),[[p,t.timeSeriesForm.whereClause]])]),i("div",Z,[a[53]||(a[53]=i("label",null,"结果限制:",-1)),m(i("input",{type:"number","onUpdate:modelValue":a[19]||(a[19]=e=>t.timeSeriesForm.limit=e),min:"1",max:"1000",placeholder:"最大结果数"},null,512),[[p,t.timeSeriesForm.limit,void 0,{number:!0}]])]),i("button",{onClick:a[20]||(a[20]=(...e)=>t.executeTimeSeriesAnalysis&&t.executeTimeSeriesAnalysis(...e)),class:"execute-btn"},"执行分析")])):"distribution"===t.currentAnalysisType?(b(),o("div",ee,[i("div",ae,[a[54]||(a[54]=i("label",null,"目标列:",-1)),m(i("select",{"onUpdate:modelValue":a[21]||(a[21]=e=>t.distributionForm.columnName=e)},[(b(!0),o(d,null,g(t.tableSchema,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,le)))),128))],512),[[v,t.distributionForm.columnName]])]),i("div",te,[a[55]||(a[55]=i("label",null,"结果限制:",-1)),m(i("input",{type:"number","onUpdate:modelValue":a[22]||(a[22]=e=>t.distributionForm.limit=e),min:"1",max:"1000",placeholder:"最大结果数"},null,512),[[p,t.distributionForm.limit,void 0,{number:!0}]])]),i("button",{onClick:a[23]||(a[23]=(...e)=>t.executeDistributionAnalysis&&t.executeDistributionAnalysis(...e)),class:"execute-btn"},"执行分析")])):"statistics"===t.currentAnalysisType?(b(),o("div",ne,[i("div",se,[a[56]||(a[56]=i("label",null,"目标列:",-1)),m(i("select",{"onUpdate:modelValue":a[24]||(a[24]=e=>t.statisticsForm.columnName=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,oe)))),128))],512),[[v,t.statisticsForm.columnName]])]),i("button",{onClick:a[25]||(a[25]=(...e)=>t.executeStatisticsAnalysis&&t.executeStatisticsAnalysis(...e)),class:"execute-btn"},"执行分析")])):"correlation"===t.currentAnalysisType?(b(),o("div",ie,[i("div",ue,[a[57]||(a[57]=i("label",null,"列 1:",-1)),m(i("select",{"onUpdate:modelValue":a[26]||(a[26]=e=>t.correlationForm.column1=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,re)))),128))],512),[[v,t.correlationForm.column1]])]),i("div",ce,[a[58]||(a[58]=i("label",null,"列 2:",-1)),m(i("select",{"onUpdate:modelValue":a[27]||(a[27]=e=>t.correlationForm.column2=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,me)))),128))],512),[[v,t.correlationForm.column2]])]),i("button",{onClick:a[28]||(a[28]=(...e)=>t.executeCorrelationAnalysis&&t.executeCorrelationAnalysis(...e)),class:"execute-btn"},"执行分析")])):"histogram"===t.currentAnalysisType?(b(),o("div",ve,[i("div",de,[a[59]||(a[59]=i("label",null,"目标列:",-1)),m(i("select",{"onUpdate:modelValue":a[29]||(a[29]=e=>t.histogramForm.columnName=e)},[(b(!0),o(d,null,g(t.numericColumns,(e=>(b(),o("option",{key:e.col_name,value:e.col_name},c(e.col_name),9,ge)))),128))],512),[[v,t.histogramForm.columnName]])]),i("div",ye,[a[60]||(a[60]=i("label",null,"分桶数:",-1)),m(i("input",{type:"number","onUpdate:modelValue":a[30]||(a[30]=e=>t.histogramForm.numBuckets=e),min:"2",max:"100",placeholder:"分桶数"},null,512),[[p,t.histogramForm.numBuckets,void 0,{number:!0}]])]),i("button",{onClick:a[31]||(a[31]=(...e)=>t.executeHistogramAnalysis&&t.executeHistogramAnalysis(...e)),class:"execute-btn"},"执行分析")])):u("",!0)]),t.analysisResults.length>0||Object.keys(t.analysisResult).length>0?(b(),o("div",pe,[a[61]||(a[61]=i("h3",null,"分析结果",-1)),t.analysisResults.length>0?(b(),o("div",be,[i("table",null,[i("thead",null,[i("tr",null,[(b(!0),o(d,null,g(t.analysisResults[0],((e,a)=>(b(),o("th",{key:a},c(a),1)))),128))])]),i("tbody",null,[(b(!0),o(d,null,g(t.analysisResults,((e,a)=>(b(),o("tr",{key:a},[(b(!0),o(d,null,g(e,((e,a)=>(b(),o("td",{key:a},c(e),1)))),128))])))),128))])])])):Object.keys(t.analysisResult).length>0?(b(),o("div",he,[(b(!0),o(d,null,g(t.analysisResult,((e,a)=>(b(),o("div",{key:a,class:"result-item"},[i("span",fe,c(a)+":",1),i("span",Ce,c(e),1)])))),128))])):u("",!0),t.showVisualization?(b(),o("div",ke,[i("div",Fe,[i("div",Ae,null,512)])])):u("",!0),i("div",_e,[i("button",{onClick:a[32]||(a[32]=e=>t.exportResults("csv")),class:"export-btn"},"导出 CSV"),i("button",{onClick:a[33]||(a[33]=e=>t.exportResults("json")),class:"export-btn"},"导出 JSON")])])):u("",!0)]))])):u("",!0)])}],["__scopeId","data-v-11e43b65"]])}},[["render",function(e,a,l,t,n,s){const u=f("HiveAnalytics");return b(),o("div",xe,[a[0]||(a[0]=i("h2",null,"Hive 数据分析中心",-1)),a[1]||(a[1]=i("p",{class:"description"},"强大的数据分析和可视化工具，深入挖掘农业数据价值",-1)),h(u)])}],["__scopeId","data-v-956684f4"]]);export{Te as default};
