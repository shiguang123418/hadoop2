import{_ as e,r as a,c as l,o as s,m as t,a as n,b as u,n as r,t as c,F as i,g as v,d,f as o,w as b,v as y,j as m,k as h,l as p}from"./index-Cx3PQcZq.js";const g={class:"hive-explorer"},k={class:"status-bar"},f={class:"status-text"},x={class:"explorer-layout"},T={class:"database-panel"},E={class:"panel-header"},w={key:0,class:"loading-indicator"},D={key:1,class:"error-message"},C={key:2,class:"database-list"},q=["onClick"],S={key:0,class:"table-list"},R={key:0,class:"loading-indicator small"},H={key:1,class:"error-message small"},A=["onClick"],L={key:3,class:"empty-message"},_={class:"query-panel"},U={class:"current-selection"},I={key:0},Q={key:1},O={class:"query-editor"},j={class:"query-actions"},M=["disabled"],P=["disabled"],$=["disabled"],F={key:0,class:"loading-indicator"},V={key:1,class:"error-message"},J={key:2,class:"query-results"},N={class:"results-header"},W={key:0,class:"results-count"},z={class:"results-table-wrapper"},B={key:0,class:"results-table"},G={key:1,class:"empty-results"},K={key:3,class:"table-schema"},X={class:"schema-header"},Y={class:"schema-table"};const Z={class:"hive-explorer-view"};const ee=e({name:"HiveExplorerView",components:{HiveExplorer:e({name:"HiveExplorer",setup(){const e=a(!1),n=a(""),u=a([]),r=a([]),c=a([]),i=a(""),v=a(""),d=a(!1),o=a(!1),b=a(null),y=a(null),m=a(""),h=a(!1),p=a([]),g=a([]),k=a(null),f=a([]),x=l((()=>p.value.length>0||g.value.length>0&&!k.value));s((async()=>{await T(),e.value&&await E()}));const T=async()=>{try{const a=await t.getStatus();return e.value=a.connected,n.value=a.url||"",e.value}catch(a){return e.value=!1,n.value="",!1}},E=async()=>{var e,a;if(await T()){d.value=!0,b.value=null;try{const e=await t.getDatabases();u.value=e.map((e=>({name:e}))),i.value&&!u.value.some((e=>e.name===i.value))&&(i.value="",v.value="",r.value=[])}catch(l){b.value=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||l.message,u.value=[]}finally{d.value=!1}}else b.value="Hive服务未连接"},w=async a=>{var l,s;if(e.value){o.value=!0,y.value=null;try{const e=await t.getTables(a);r.value=e.map((e=>({name:e})))}catch(n){y.value=(null==(s=null==(l=n.response)?void 0:l.data)?void 0:s.error)||n.message,r.value=[]}finally{o.value=!1}}else y.value="Hive服务未连接"},D=async a=>{if(e.value&&i.value)try{const e=await t.getTableSchema(a,i.value);Array.isArray(e)?f.value=e.map((e=>{if(e.col_name||e.data_type)return{name:e.col_name,type:e.data_type,comment:e.comment||""};const a=Object.keys(e);return a.length>=2?{name:e[a[0]],type:e[a[1]],comment:a.length>2?e[a[2]]:""}:{name:JSON.stringify(e),type:"-",comment:"-"}})):f.value=[]}catch(l){f.value=[]}},C=async()=>{var a,l;if(m.value&&e.value){h.value=!0,k.value=null,p.value=[],g.value=[];try{let e;"SELECT"===q(m.value)?(e=await t.executeQuery(m.value),e&&Array.isArray(e)&&e.length>0?(g.value=Object.keys(e[0]),p.value=e):e&&e.columns?(g.value=e.columns,p.value=e.data||[]):(g.value=["结果"],p.value=[{"结果":"查询执行成功，没有返回数据"}])):(e=await t.executeUpdate(m.value),g.value=["结果"],e?e.success?p.value=[{"结果":`操作成功，影响 ${e.rowsAffected||0} 行`}]:void 0!==e.rowsAffected?p.value=[{"结果":`操作成功，影响 ${e.rowsAffected} 行`}]:(Array.isArray(e),p.value=[{"结果":"操作成功"}]):p.value=[{"结果":"操作成功"}])}catch(s){const e=q(m.value),t=(null==(l=null==(a=s.response)?void 0:a.data)?void 0:l.error)||s.message||"";"SELECT"!==e&&(t.includes("success")||t.includes("成功")||t.includes("SUCCESS")||!t)?(g.value=["结果"],p.value=[{"结果":"操作可能已成功执行，但返回结果格式有误"}]):k.value=t}finally{h.value=!1}}},q=e=>e.trim().toUpperCase().startsWith("SELECT")?"SELECT":"UPDATE";return{connected:e,hiveUrl:n,databases:u,tables:r,expandedDatabases:c,currentDatabase:i,currentTable:v,loadingDatabases:d,loadingTables:o,databaseError:b,tableError:y,queryText:m,executing:h,queryResults:p,columns:g,queryError:k,tableSchema:f,hasResults:x,refreshStatus:T,refreshDatabases:E,selectDatabase:async e=>{if(c.value.includes(e))return c.value=c.value.filter((a=>a!==e)),void(i.value===e&&(v.value="",f.value=[]));c.value=[...c.value,e],i.value=e,await w(e)},selectTable:async e=>{v.value=e,await D(e)},executeQuery:C,loadTablePreview:async()=>{i.value&&v.value&&(m.value=`SELECT * FROM ${i.value}.${v.value} LIMIT 100`,await C())},clearResults:()=>{p.value=[],g.value=[],k.value=null}}}},[["render",function(e,a,l,s,t,h){return m(),n("div",g,[u("div",k,[u("span",{class:r(["status-indicator",s.connected?"connected":"disconnected"])},null,2),u("span",f,c(s.connected?"已连接":"未连接")+" "+c(s.hiveUrl),1),u("button",{onClick:a[0]||(a[0]=(...e)=>s.refreshStatus&&s.refreshStatus(...e)),class:"refresh-btn"},"刷新")]),u("div",x,[u("div",T,[u("div",E,[a[8]||(a[8]=u("h3",null,"数据库与表",-1)),u("button",{onClick:a[1]||(a[1]=(...e)=>s.refreshDatabases&&s.refreshDatabases(...e)),class:"refresh-btn small"},a[7]||(a[7]=[u("span",{class:"refresh-icon"},null,-1)]))]),s.loadingDatabases?(m(),n("div",w," 加载数据库列表... ")):s.databaseError?(m(),n("div",D,[u("p",null,c(s.databaseError),1),u("button",{onClick:a[2]||(a[2]=(...e)=>s.refreshDatabases&&s.refreshDatabases(...e)),class:"retry-btn"},"重试")])):(m(),n("div",C,[(m(!0),n(i,null,v(s.databases,(e=>(m(),n("div",{key:e.name,class:"database-item"},[u("div",{class:r(["database-name",{active:s.currentDatabase===e.name}]),onClick:a=>s.selectDatabase(e.name)},[a[9]||(a[9]=u("i",{class:"database-icon"},"🗃️",-1)),u("span",null,c(e.name),1),u("span",{class:r(["expander",{expanded:s.expandedDatabases.includes(e.name)}])},c(s.expandedDatabases.includes(e.name)?"▼":"▶"),3)],10,q),s.expandedDatabases.includes(e.name)?(m(),n("div",S,[s.loadingTables&&s.currentDatabase===e.name?(m(),n("div",R," 加载表... ")):s.tableError&&s.currentDatabase===e.name?(m(),n("div",H,c(s.tableError),1)):(m(!0),n(i,{key:2},v(s.tables,(e=>(m(),n("div",{key:e.name,class:r(["table-item",{active:s.currentTable===e.name}]),onClick:a=>s.selectTable(e.name)},[a[10]||(a[10]=u("i",{class:"table-icon"},"📊",-1)),u("span",null,c(e.name),1)],10,A)))),128)),0!==s.tables.length||s.loadingTables||s.currentDatabase!==e.name?d("",!0):(m(),n("div",L," 无表 "))])):d("",!0)])))),128))]))]),u("div",_,[a[15]||(a[15]=u("div",{class:"panel-header"},[u("h3",null,"Hive 查询")],-1)),u("div",U,[s.currentDatabase?(m(),n("span",I,[a[11]||(a[11]=o("当前数据库: ")),u("strong",null,c(s.currentDatabase),1)])):d("",!0),s.currentTable?(m(),n("span",Q,[a[12]||(a[12]=o("| 当前表: ")),u("strong",null,c(s.currentTable),1)])):d("",!0)]),u("div",O,[b(u("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>s.queryText=e),placeholder:"输入HiveQL查询，例如: SELECT * FROM table LIMIT 10",rows:"5",class:"sql-textarea"},null,512),[[y,s.queryText]]),u("div",j,[u("button",{onClick:a[4]||(a[4]=(...e)=>s.executeQuery&&s.executeQuery(...e)),class:"execute-btn",disabled:!s.queryText||s.executing},c(s.executing?"执行中...":"执行查询"),9,M),u("button",{onClick:a[5]||(a[5]=(...e)=>s.loadTablePreview&&s.loadTablePreview(...e)),class:"preview-btn",disabled:!s.currentTable||s.executing}," 查看表数据 ",8,P),u("button",{onClick:a[6]||(a[6]=(...e)=>s.clearResults&&s.clearResults(...e)),class:"clear-btn",disabled:!s.hasResults}," 清除结果 ",8,$)])]),s.executing?(m(),n("div",F," 执行查询中... ")):s.queryError?(m(),n("div",V,[u("p",null,"查询错误: "+c(s.queryError),1)])):s.hasResults?(m(),n("div",J,[u("div",N,[a[13]||(a[13]=u("h4",null,"查询结果",-1)),s.queryResults.length?(m(),n("span",W,c(s.queryResults.length)+" 行",1)):d("",!0)]),u("div",z,[s.queryResults.length&&s.columns.length?(m(),n("table",B,[u("thead",null,[u("tr",null,[(m(!0),n(i,null,v(s.columns,(e=>(m(),n("th",{key:e},c(e),1)))),128))])]),u("tbody",null,[(m(!0),n(i,null,v(s.queryResults,((e,a)=>(m(),n("tr",{key:a},[(m(!0),n(i,null,v(s.columns,(a=>(m(),n("td",{key:a},c(e[a]),1)))),128))])))),128))])])):0===s.queryResults.length?(m(),n("div",G," 查询执行成功，但没有返回数据 ")):d("",!0)])])):d("",!0),s.tableSchema.length>0?(m(),n("div",K,[u("div",X,[u("h4",null,"表结构: "+c(s.currentTable),1)]),u("table",Y,[a[14]||(a[14]=u("thead",null,[u("tr",null,[u("th",null,"列名"),u("th",null,"数据类型"),u("th",null,"备注")])],-1)),u("tbody",null,[(m(!0),n(i,null,v(s.tableSchema,((e,a)=>(m(),n("tr",{key:a},[u("td",null,c(e.name||"-"),1),u("td",null,c(e.type||"-"),1),u("td",null,c(e.comment||"-"),1)])))),128))])])])):d("",!0)])])])}],["__scopeId","data-v-da5fca56"]])}},[["render",function(e,a,l,s,t,r){const c=p("HiveExplorer");return m(),n("div",Z,[a[0]||(a[0]=u("h2",null,"Hive 查询管理器",-1)),a[1]||(a[1]=u("p",{class:"description"},"浏览 Hive 数据库和表，执行 HiveQL 查询",-1)),h(c)])}],["__scopeId","data-v-d1ab70b9"]]);export{ee as default};
